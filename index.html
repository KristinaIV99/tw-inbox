<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskWarrior Inbox</title>
    
    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TaskInbox">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <link rel="stylesheet" href="projekt/css/main.css">
</head>
<body>
    <div class="main-container">
        <div class="app-header">
            <h1>TASKWARRIOR INBOX</h1>
            
            <div id="installPrompt" class="install-prompt" style="display: none;">
                <button id="installBtn" class="install-btn">üì± ƒÆdiegti programƒólƒô</button>
            </div>
        </div>

        <!-- 1. DESCRIPTION - neprivaloma -->
        <div class="task-card" data-card="description">
            <div class="card-header">
                <h2>TaskWarrior DESCRIPTION</h2>
                <button class="help-btn" onclick="showHelpModal('DESCRIPTION')" title="Pagalba apie DESCRIPTION laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <!-- Description kategorijos -->
                <div class="description-categories" id="descriptionCategories">
                    <!-- Kategorijos bus sugeneruotos JavaScript -->
                </div>
            </div>
        </div>

        <!-- 2. ANNOTATE - neprivaloma -->
        <div class="task-card" data-card="annotate">
            <div class="card-header">
                <h2>TaskWarrior ANNOTATE</h2>
                <button class="help-btn" onclick="showHelpModal('ANNOTATE')" title="Pagalba apie ANNOTATE laukƒÖ">?</button>
            </div>
            <div class="card-content">
                <div id="annotateContainer">
                    <!-- Annotate textarea bus sugeneruotas JavaScript -->
                </div>
            </div>
        </div>

        <!-- 3. ACTIONS -->
        <div class="task-card" data-card="actions">
            <div class="card-header">
                <h2>TaskWarrior</h2>
            </div>
            <div class="card-content">
                <!-- Mygtukai PIRMA -->
                <div class="segmented-actions">
                    <button class="seg-action save" id="saveBtn">SAVE</button>
                    <button class="seg-action export" id="exportBtn">EXPORT</button>
                </div>
                
                <!-- Real-time preview zona ANTRA -->
                <div class="global-preview-section" id="commandPreviewContainer">
                    <div id="commandPreview">
                        <!-- Preview bus ƒçia -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. STATISTICS -->
        <div class="task-card stats-card" data-card="stats">
            <div class="card-content">
                <div class="stats-display">
                    I≈°saugota u≈æduoƒçi≈≥: <span id="taskCount">0</span>
                </div>
            </div>
        </div>

        <!-- 5. STATUS -->
        <div class="task-card status-card" data-card="status">
            <div class="card-content">
                <div class="status-display">
                    <span class="status-indicator online" id="statusIndicator">üü¢</span>
                    <span class="status-text" id="statusText">Online</span>
                </div>
            </div>
        </div>

    </div> <!-- Closing main-container -->

    <!-- HELP MODAL -->
    <div id="helpModal" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 id="helpModalTitle">Pagalba</h3>
                <span class="help-modal-close" onclick="closeHelpModal()">&times;</span>
            </div>
            <div class="help-modal-body" id="helpModalBody">
                <!-- Help tekstas bus ƒØstatytas ƒçia -->
            </div>
            <div class="help-modal-footer">
                <button class="help-modal-btn" onclick="closeHelpModal()">Gerai</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT IMPORTS - CLEANED -->
    <script src="projekt/localStorage-manager.js"></script>
    <script src="projekt/config.js"></script>
    <script src="projekt/data.js"></script>
    <script src="projekt/export-manager.js"></script>
    <script src="projekt/app.js"></script>
    <script src="projekt/cards/description-card.js"></script>
    <script src="projekt/cards/annotate-card.js"></script>
    <script src="projekt/cards/actions-card.js"></script>
    <script src="projekt/cards/statistics-card.js"></script>
    
    <!-- Help modal -->
    <script src="projekt/help-modal.js"></script>
    
    <!-- Update notification -->
    <div id="updateNotification" style="display: none;">
        <div class="update-banner">
            <span>üîÑ Naujas atnaujinimas prieinamas!</span>
            <button id="updateBtn">Atnaujinti dabar</button>
            <button id="dismissBtn">Vƒóliau</button>
        </div>
    </div>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/tw-inbox/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered');
                        
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification(newWorker);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
        
        function showUpdateNotification(newWorker) {
            const notification = document.getElementById('updateNotification');
            const updateBtn = document.getElementById('updateBtn');
            const dismissBtn = document.getElementById('dismissBtn');
            
            notification.style.display = 'block';
            
            updateBtn.onclick = () => {
                newWorker.postMessage({ type: 'SKIP_WAITING' });
                window.location.reload();
            };
            
            dismissBtn.onclick = () => {
                notification.style.display = 'none';
            };
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (installPrompt) {
                installPrompt.style.display = 'block';
            }
        });

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('User accepted install');
                }
                
                deferredPrompt = null;
                if (installPrompt) {
                    installPrompt.style.display = 'none';
                }
            });
        }

        window.addEventListener('appinstalled', () => {
            if (installPrompt) {
                installPrompt.style.display = 'none';
            }
            console.log('PWA installed');
        });
    </script>
</body>
</html>
